<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Flight Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            padding: 40px;
        }

        h1 {
            text-align: center;
        }

        form {
            background: white;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-top: 12px;
            font-weight: bold;
        }

        input,
        button {
            width: 100%;
            padding: 8px;
            margin-top: 6px;
        }

        button {
            margin-top: 20px;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .error {
            color: red;
            text-align: center;
            margin-bottom: 20px;
        }

        .flight {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }
    </style>

    <script>
        function toggleTripType() {
            const type = document.getElementById("type").value;
            document.getElementById("return-date").classList.add("hidden");
            document.getElementById("multi-city").classList.add("hidden");

            if (type === "1") {
                document.getElementById("return-date").classList.remove("hidden");
            } else if (type === "3") {
                document.getElementById("multi-city").classList.remove("hidden");
            }
        }

        function addLeg() {
            const leg = document.createElement("div");
            leg.className = "leg";
            leg.innerHTML = `
            <input type="text" placeholder="From (SFO)" class="from" required>
            <input type="text" placeholder="To (LAX)" class="to" required>
            <input type="date" class="date" required>
        `;
            document.getElementById("legs").appendChild(leg);
        }

        function buildMultiCityJSON() {
            const legs = document.querySelectorAll(".leg");
            const trips = [];

            legs.forEach(leg => {
                const from = leg.querySelector(".from").value;
                const to = leg.querySelector(".to").value;
                const date = leg.querySelector(".date").value;

                if (from && to && date) {
                    trips.push({
                        departure_id: from,
                        arrival_id: to,
                        date: date
                    });
                }
            });

            document.getElementById("multi_city_json").value = JSON.stringify(trips);
        }
    </script>
</head>

<body>

    <h1>✈️ Flight Search</h1>

    {% if error %}
    <div class="error">{{ error }}</div>
    {% endif %}

    <form method="POST">
        <select id="type" onchange="toggleTripType()" name="type">
            <option value="1">Round trip</option>
            <option value="2">One way</option>
            <option value="3">Multi-city</option>
        </select>

        <select id="travel_class" name="travel_class">
            <option value="1">Economy</option>
            <option value="2">Premium Economy</option>
            <option value="3">Business</option>
            <option value="4">First Class</option>
        </select>

        <label>Passengers</label>
        <input type="number" name="adults" min="1" value="1" required>

        <label for="origin">Origin Airport Code</label>
        <input type="text" id="origin" name="origin" placeholder="SFO" required>

        <label for="destination">Destination Airport Code</label>
        <input type="text" id="destination" name="destination" placeholder="LAX" required>

        <label for="outbound_date">Departure Date</label>
        <input type="date" id="outbound_date" name="outbound_date" required>

        <div id="return-date" class="hidden">
            <label>Return Date</label>
            <input type="date" id="return_date" name="return_date">
        </div>


        <div id="multi-city" class="hidden">
            <label>Multi-City Flights</label>

            <div id="legs">
                <div class="leg">
                    <input type="text" placeholder="From (SFO)" class="from" required>
                    <input type="text" placeholder="To (LAX)" class="to" required>
                    <input type="date" class="date" required>
                </div>
            </div>

            <button type="button" onclick="addLeg()"> Add another trip</button>
            <input type="hidden" name="multi_city_json" id="multi_city_json">


        </div>

        <label>Country</label>
        <input type="text" placeholder="Put your two letter Country Code here" name="gl">

        <label>Language</label>
        <input type="text" placeholder="Put your two letter Language Code here" name="hl">

        <button type="submit">Search Flights</button>
    </form>

    {% if flights %}
    <h3>Best Flights</h3>
    <ul>
        {% for flight in flights %}
        <li>
            {{ flight.flights[0].departure_airport.name }}
            →
            {{ flight.flights[-1].arrival_airport.name }}
            <p>
                Price : {{ flight.price }}
                Cabin:{{ flight.travel_class }}
            </p>

        </li>
        {% endfor %}
    </ul>
    {% endif %}

</body>

</html>